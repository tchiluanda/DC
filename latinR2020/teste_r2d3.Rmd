---
title: "teste_r2d3"
output:
  html_document:
    css: style.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(r2d3)
```


```{css, echo=FALSE}
.dentro-d3 {
  stroke: coral;
}

div.container-d3 {
  background-color: whitesmoke;
  position: relative;
}

.annotation {
  position: absolute;
  color: coral;
}

.seletor ul {
  list-style: none;
  display: flex;
  justify-content: space-around;
  max-width: 300px;
}

.seletor ul li {
  cursor: pointer;
  border-bottom: 3px solid transparent;
}

.seletor ul li:hover {
  border-bottom: 3px solid #1e1e1e;
  color: #1e1e1e;  
}

.seletor ul li.selecionado {
  border-bottom: 3px solid firebrick;
  color: firebrick;
  font-weight: bold;
}



svg { /*não funciona*/
  background-color: whitesmoke;
} 

#scrolly {
  position: relative;
  display: flex;
}

#scrolly figure {
  position: sticky;
  width: 100%;
  margin: 0;
}

#scrolly figure p {
  position: absolute;
  padding: 1rem;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 8rem;
  color: #fff;
}

#scrolly .steps {
  position: relative;
  padding: 0 1rem;
  max-width: 20rem;
}

# scrolly .steps p {
  margin: 0 auto 2rem auto;
  background-color: #3b3b3b;
  color: #fff;
  text-align: center;
  padding: 1rem;
  font-size: 1.5rem;
}

# scrolly .steps p:last-child {
  margin-bottom: 0;
}

# scrolly .steps p.is-active {
  background-color: goldenrod;
  color: #3b3b3b;
}

```


Aqui, fora do d3.

Vou tentar mudar isso aqui para [azul]{.fora-d3} usando d3.

Desenhe um...

::::: {.seletor}
* quadrado
* círculo
:::::

Teste de um container...

::::: {.super}
<div class="container-d3">

```{d3, echo = FALSE}
d3.select(".fora-d3").style("color", "blue");

svg.append("text")
  .classed("dentro-d3", true)
  .text("Vou tentar mudar isso aqui para vermelho usando chunk de css.")
  .attr("x", 20)
  .attr("y", 20);
  
d3.select(".container-d3")
  .append("p")
  .text("Hi!")
  .classed("annotation", true)
  .style("top", "40px")
  .style("left", "20px");
  
svg.append("circle").attr("cx", 50+25).attr("cy", 70+25).attr("r", 25).attr("stroke", "steelblue").attr("fill", "dodgerblue").attr("opacity", 0);
svg.append("rect").attr("x", 50).attr("y", 70).attr("width", 50).attr("height", 50).attr("stroke", "coral").attr("fill", "lightcoral").attr("opacity", 0);
  
d3.selectAll(".seletor li").on("click", function() {
  let selecionado = d3.select(this);
  d3.selectAll(".seletor li").classed("selecionado", false);
  selecionado.classed("selecionado", true);
  if (selecionado.text() == "círculo") {
    svg.select("rect").transition().duration(200).attr("opacity", 0);
    svg.select("circle").transition().duration(200).attr("opacity", 1);

  } else {
    svg.select("rect").transition().duration(200).attr("opacity", 1);
    svg.select("circle").transition().duration(200).attr("opacity", 0);
  };
})

```
</div>

:::::

<div id="scrolly">

<figure>

```{r}
x <- list("primeiro" = data.frame("a" = c(1,2), "b" = c(4,5)),
          "segundo" = data.frame("c" = c(1,2), "d" = c(4,5)))
```


```{d3 data = x}

//console.log(Object.keys(data))
console.log(data["primeiro"]["a"][0])

```

</figure>

::::: {.steps}

Primeiro step.

Segundo step.

:::::

</div>


Algumas conclusões, até agora:

* não consigo estilizar elementos do svg usando o meu chunk css. Isso porque, descobri, o svg está dentro de um shadow dom. vai ter q ser tudo inline.
* consigo acessar no d3 qq coisa do documento (o container do htmlwidget não é um iframe, é um div), então consigo fazer o d3 escutar coisas q estão acontecendo fora.


